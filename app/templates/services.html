{% extends "base.html" %}
{% block title %}测试服务管理页{% endblock %}

{% block body %}
{{ super() }}

<div id="addTypeModal" class="modal fade" role="dialog" aria-labelledby="gridSystemModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
		
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="modalTitle">新增测试服务</h4>
			</div>
			
			<div class="modal-body">
				<form id="serviceform" action="/services" method="post">
					{{ form.csrf_token }}
					<div id="namediv" style="margin-bottom:10px">
					{{ form.name.label }}{{ form.name(class="form-control") }}
					</div>
					<div id="addressdiv" style="margin-bottom:10px">
					{{ form.address.label }}{{ form.address(class="form-control") }}
					</div>
					<div style="margin-bottom:10px">
					{{ form.type.label }}{{ form.type(class="form-control") }}
					</div>
				<form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<a id="submit" onclick="validate_on_submit()" class="btn btn-primary">提交</a>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="container">
	<div class="page-header">
		<h2 class="ng-binding">测试服务配置</h2>
		{% for message in get_flashed_messages() %}
			{% if message.type == 'error' %}
				<div class="alert alert-danger alert-dismissible fade in" role="alert">
			{% else %}
				<div class="alert alert-success alert-dismissible fade in" role="alert">
			{% endif %}
					<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
					<h5>
						{{ message.message }}
					</h5>
				</div>
		{% endfor %}
	</div>

	<div>
		<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addTypeModal">新增测试服务</button>
	</div>
	
	<div style="margin-top:10px;">
	    <table name="table1" class="table table-striped">
	        <tbody>
	        <tr>
	            <th style="width:10%">ID</th>
	            <th style="width:15%">测试服务名称</th>
	            <th style="width:15%">测试服务地址</th>
	            <th style="width:15%">服务类型</th>
	            <th style="width:15%">创建时间</th>
	            <th style="width:10%">&nbsp&nbsp&nbsp&nbsp操作</th>
	        </tr>
	{% if services %}
		{% for serv in services %}
			{% if serv.status != -1 %}
				<tr class="ng-scope">
					<td class="ng-binding">{{serv.id}}</td>
					<td class="ng-binding">{{serv.name}}</td>
					<td class="ng-binding">{{serv.address}}</td>
					<td class="ng-binding">{{serv.typename}}</td>
					<td class="ng-binding">{{serv.createdtime}}</td>
					<td class="ng-bliding">
						<a class="btn btn-danger" onclick="del({{ serv.id }})">删除</button>
					</td>
				</tr>
			{% endif %}
		{% endfor %}
	{% endif %}
	        </tbody>
	    </table>
	</div>
</div>

<script language="javascript">
	function del(id) {
		bootbox.confirm("是否确认删除服务？",function(result){
			if(result) {
                $.get('/delservice/'+id,function(data){
                    if (data == "success") {
				        location.reload(0);
                    }
                });
			}else{
				console.log("choice false");
			}
		});
	}
	
	function validate_on_submit() {
		var ispass = true;
		var name = document.getElementById("name");
		var namediv = document.getElementById("namediv");
		var address = document.getElementById("address");
		var addressdiv = document.getElementById("addressdiv");
		if(name.value == '') {
			namediv.setAttribute("class", "form-group has-error");
			name.placeholder = "请输入服务名称";
			ispass = false;
		}else {
			namediv.setAttribute("class", "");
			name.placeholder = "";
		}
		if(address.value == '') {
			addressdiv.setAttribute("class", "form-group has-error");
			address.placeholder = "请输入服务地址";
			ispass = false;
		}else {
			addressdiv.setAttribute("class", "");
			address.placeholder = "";
		}
		
		if (ispass) {
			var submit = document.getElementById('submit');
			submit.onclick = null;
			submit.innerHTML = "正在提交..";
			$("#serviceform").submit();
		}
	}
</script>

{% endblock %}


